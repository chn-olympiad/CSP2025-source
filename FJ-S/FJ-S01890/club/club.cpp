#include <bits/stdc++.h>
using namespace std;
const int N=1e5+2;

int t,n,a[N][4],b[N],c[N],sum;

void qsort(int b[],int c[],int l,int r){
	if(l>=r) return ;
	int x=b[(l+r)/2];
	int i=l-1,j=r+1;
	while(i<j){
		while(b[++i]<x);
		while(b[--j]>x);
		if(i<j){
			swap(b[i],b[j]);
			swap(c[i],c[j]);
		}
	}
	qsort(b,c,l,j);
	qsort(b,c,i+1,r);
}

int main(){
	freopen("club.in","r",stdin);
	freopen("club.out","w",stdout);
	cin>>t;
	int fa=1,fb=1;
	while(t--){
		cin>>n;
		for(int i=1;i<=n;i++){
			cin>>a[i][1]>>a[i][2]>>a[i][3];
			if(a[i][2]!=0) fa=0;
			if(a[i][3]!=0) fb=0;
		}
		if(fa==1){
			for(int i=1;i<=n;i++) b[i]=a[i][1];
			sort(b+1,b+n+1);
			for(int i=1;i*2<=n;i++) sum+=b[n-i+1];
			cout<<sum<<endl;
			continue;
		}
		if(n<=200){
			if(n==2){
				sum=0;
				for(int i=1;i<=3;i++){
					for(int j=1;j<=3;j++){
						if(j==i) continue;
						if(a[1][i]+a[2][j]>sum){
							sum=a[1][i]+a[2][j];
						}
					}
				}
				cout<<sum<<endl;
				continue;
			}
			if(n==4){
				sum=0;
				int s[55];
				s[0 ]=a[1][1]+a[2][1]+a[3][2]+a[4][2];
				s[1 ]=a[1][1]+a[2][1]+a[3][2]+a[4][3];
				s[2 ]=a[1][1]+a[2][1]+a[3][3]+a[4][2];
				s[3 ]=a[1][1]+a[2][1]+a[3][3]+a[4][3];
				
				s[4 ]=a[1][1]+a[2][2]+a[3][1]+a[4][2];
				s[5 ]=a[1][1]+a[2][2]+a[3][1]+a[4][3];
				
				s[6 ]=a[1][1]+a[2][2]+a[3][2]+a[4][1];
				s[7 ]=a[1][1]+a[2][2]+a[3][2]+a[4][3];
				
				s[8 ]=a[1][1]+a[2][2]+a[3][3]+a[4][1];
				s[9 ]=a[1][1]+a[2][2]+a[3][3]+a[4][2];
				s[10]=a[1][1]+a[2][2]+a[3][3]+a[4][3];
				
				s[11]=a[1][1]+a[2][3]+a[3][1]+a[4][2];
				s[12]=a[1][1]+a[2][3]+a[3][1]+a[4][3];
				
				s[13]=a[1][1]+a[2][3]+a[3][2]+a[4][1];
				s[14]=a[1][1]+a[2][3]+a[3][2]+a[4][2];
				s[15]=a[1][1]+a[2][3]+a[3][2]+a[4][3];
				
				s[16]=a[1][1]+a[2][3]+a[3][3]+a[4][1];
				s[17]=a[1][1]+a[2][3]+a[3][3]+a[4][2];
				
				s[18]=a[1][2]+a[2][1]+a[3][1]+a[4][2];
				s[19]=a[1][2]+a[2][1]+a[3][1]+a[4][3];
				
				s[20]=a[1][2]+a[2][1]+a[3][2]+a[4][1];
				s[21]=a[1][2]+a[2][1]+a[3][2]+a[4][3];
				
				s[22]=a[1][2]+a[2][1]+a[3][3]+a[4][1];
				s[23]=a[1][2]+a[2][1]+a[3][3]+a[4][2];
				s[24]=a[1][2]+a[2][1]+a[3][3]+a[4][3];
				
				s[25]=a[1][2]+a[2][2]+a[3][1]+a[4][1];
				s[26]=a[1][2]+a[2][2]+a[3][1]+a[4][3];
				
				s[27]=a[1][2]+a[2][2]+a[3][3]+a[4][1];
				s[28]=a[1][2]+a[2][2]+a[3][3]+a[4][3];
				
				s[29]=a[1][2]+a[2][3]+a[3][1]+a[4][1];
				s[30]=a[1][2]+a[2][3]+a[3][1]+a[4][2];
				s[31]=a[1][2]+a[2][3]+a[3][1]+a[4][3];
				s[32]=a[1][2]+a[2][3]+a[3][2]+a[4][1];
				s[33]=a[1][2]+a[2][3]+a[3][2]+a[4][3];
				
				s[34]=a[1][2]+a[2][3]+a[3][3]+a[4][1];
				s[35]=a[1][2]+a[2][3]+a[3][3]+a[4][2];
				
				s[36]=a[1][3]+a[2][1]+a[3][1]+a[4][2];
				s[37]=a[1][3]+a[2][1]+a[3][1]+a[4][3];
				
				s[38]=a[1][3]+a[2][1]+a[3][2]+a[4][1];
				s[39]=a[1][3]+a[2][1]+a[3][2]+a[4][2];
				s[40]=a[1][3]+a[2][1]+a[3][2]+a[4][3];
				
				s[41]=a[1][3]+a[2][1]+a[3][3]+a[4][1];
				s[42]=a[1][3]+a[2][1]+a[3][3]+a[4][2];
				
				s[43]=a[1][3]+a[2][2]+a[3][1]+a[4][1];
				s[44]=a[1][3]+a[2][2]+a[3][1]+a[4][2];
				s[45]=a[1][3]+a[2][2]+a[3][1]+a[4][3];
				
				s[46]=a[1][3]+a[2][2]+a[3][2]+a[4][1];
				s[47]=a[1][3]+a[2][2]+a[3][2]+a[4][3];
				
				s[48]=a[1][3]+a[2][2]+a[3][3]+a[4][1];
				s[49]=a[1][3]+a[2][2]+a[3][3]+a[4][2];
				
				s[50]=a[1][3]+a[2][3]+a[3][1]+a[4][1];
				s[51]=a[1][3]+a[2][3]+a[3][1]+a[4][2];
				
				s[52]=a[1][3]+a[2][3]+a[3][2]+a[4][1];
				s[53]=a[1][3]+a[2][3]+a[3][2]+a[4][2];
				
				for(int i=0;i<=53;i++){
					if(s[i]>sum) sum=s[i];
				}
				
				cout<<sum<<endl;
				continue;
			}
			if(n==10){
				sum=0;
				/*int i[11];
				for(i[1]=1;i[1]<=3;i[1]++){
					for(i[2]=1;i[2]<=3;i[2]++){
						for(i[3]=1;i[3]<=3;i[3]++){
							for(i[4]=1;i[4]<=3;i[4]++){
								for(i[5]=1;i[5]<=3;i[5]++){
									for(i[6]=1;i[6]<=3;i[6]++){
										for(i[7]=1;i[7]<=3;i[7]++){
											for(i[8]=1;i[8]<=3;i[8]++){
												for(i[9]=1;i[9]<=3;i[9]++){
													for(i[10]=1;i[10]<=3;i[10]++){
														int c[4]={0,0,0,0};
														for(int j=1;j<=10;j++) c[i[j]]++;
														if(c[1]>2 || c[2]>2 || c[3]>2) continue;
														int ans=0;
														for(int j=1;j<=10;j++) ans+=a[j][i[j]];
														if(ans>sum) sum=ans;
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}*/
				for(int i1=1;i1<=3;i1++){
					for(int i2=1;i2<=3;i2++){
						for(int i3=1;i3<=3;i3++){
							for(int i4=1;i4<=3;i4++){
								for(int i5=1;i5<=3;i5++){
									for(int i6=1;i6<=3;i6++){
										for(int i7=1;i7<=3;i7++){
											for(int i8=1;i8<=3;i8++){
												for(int i9=1;i9<=3;i9++){
													for(int i10=1;i10<=3;i10++){
														int c[4]={0,0,0,0};
														c[i1]++;c[i2]++;c[i3]++;
														c[i4]++;c[i5]++;c[i6]++;
														c[i7]++;c[i8]++;c[i9]++;
														c[i10]++;
														if(c[1]>5||c[2]>5||c[3]>5) continue;
														int ans=a[1][i1]+a[2][i2]+a[3][i3]+a[4][i4]+a[5][i5]+a[6][i6]+a[7][i7]+a[8][i8]+a[9][i9]+a[10][i10];
														if(ans>sum) sum=ans;
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				
				cout<<sum<<endl;
				continue;
			}
		}
		if(fb==0){
			for(int i=1;i<=n;i++){
				b[i]=a[i][1];
				c[i]=a[i][2];
			}
			qsort(b,c,1,n);
			
			
			
			qsort(c,b,1,n);
		}
		
	}
	
	return 0;
}
